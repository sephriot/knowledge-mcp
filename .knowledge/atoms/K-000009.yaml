id: K-000009
title: Config Package - Path Resolution
type: pattern
status: active
confidence: high
content:
    summary: The config package handles data path resolution with fallback logic and provides path helpers for storage locations.
    details: |-
        ## Path Resolution Priority

        1. `--data-path` CLI flag (if provided)
        2. `KNOWLEDGE_MCP_PATH` environment variable
        3. Default: `.knowledge` in current working directory

        Relative paths are automatically resolved to absolute paths using the current working directory.

        ## Key Functions

        | Function | Description |
        |----------|-------------|
        | `New(dataPath)` | Create config with path resolution |
        | `IndexPath()` | Returns `{DataPath}/index.json` |
        | `AtomsPath()` | Returns `{DataPath}/atoms` |
        | `EnsureDirs()` | Creates storage directories if missing |
        | `GetConfig()` | Returns global config singleton |
        | `SetConfig(cfg)` | Sets global config singleton |

        ## Usage Pattern

        ```go
        // In main.go
        cfg := config.New(*dataPath)  // From CLI flag
        config.SetConfig(cfg)         // Set as global

        // In other packages
        cfg := config.GetConfig()
        indexPath := cfg.IndexPath()
        ```
    pitfalls:
        - Relative paths are resolved at startup time - changing working directory later won't affect stored paths.
        - GetConfig() creates a default config if none was set, which may not be desired.
    update_notes:
        - date: "2026-01-21"
          note: Initial creation
language: go
created_at: "2026-01-21"
updated_at: "2026-01-21"
tags:
    - config
    - path-resolution
    - storage
    - singleton
sources:
    - kind: repo_path
      ref: config/config.go
links:
    - rel: see_also
      id: K-000003
supersedes: []
